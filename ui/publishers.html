<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Muli Font from Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

  <title> Congregation Scheduler </title>
  <style>
    body {
      font-family: 'Muli', sans-serif;
    }

    #title {
      text-indent: 10px;
    }

    #publisherHeaderName {
      font-size : 20px;
    }

    #publisherHeaderContent {
      font-size : 14px;
    }

    .nowrap {
        white-space: nowrap ;
    }

    .affix {
      top: 20px;
      z-index: 9999 !important;
    }

    button {
      border-radius: 10px;
    }

    .content {
      position : relative;
    }

    #button-row {
      padding-top : 5px;
      padding-bottom : 5px;
    }

    #left-button-link {
      position : fixed;
      bottom : 0;
      left : 0;
    }

    #right-button-link {
      position : fixed;
      bottom : 0;
      right : 0;
    }
  </style>
</head>

<body>
  <div>
    <h1 id="title">Cupertino Congregation</h1>
  </div>


  <!-- Optional Javascript -->

  <nav class="navbar navbar navbar-default navbar-static-top">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="/ui/home.html">Home</a>
      </div>
      <ul class="nav navbar-nav navbar-left">
        <li><a href="/ui/publishers.html">Publishers</a></li>
        <li><a href="/ui/about.html">About</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
      </ul>
    </div>
  </nav>

  <!-- Sort publishers by... section -->
  <div class="container-fluid">
    <div class="row">
      <nav class="col-xs-3">
        <div class="col-xs-9">
          <div>
            <!-- Modal Trigger -->
            <button type="button" class="btn btn-info btn-md" data-toggle="modal" data-target="#addPublisherModal">Add Publisher</button>
            <ul class="nav nav-pills nav-stacked" data-spy="affix" data-offset-top="205">
              <h3>Sort by:</h3>
              <li class="active"><a href="#section1">Most Recent Assignment</a></li>
              <li><a href="#section2">First Name</a></li>
              <li><a href="#section3">Last Name</a></li>
              <li><a href="#section4">Age</a></li>
              <script>
                $(".nav li").on("click", function() {
                $(".nav li").removeClass("active");
                $(this).addClass("active");
              });
            </script>
            </ul>
      </nav>
      <div class="col-xs-9">
        <!-- Modal -->
        <div id="addPublisherModal" class="modal fade" role="dialog">
          <div class="modal-dialog">
            <!-- Modal Content -->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3 class="modal-title">Publisher Information</h3>
              </div>
              <div class="modal-body" style="height: 370px">
                <form id="addPublisherForm" class="form-horizontal">
                  <div class="form-group">
                    <label class="col-xs-3 control-label">First Name:</label>
                    <div class="col-xs-9" style="padding-right: 50px">
                      <input id="firstNameInput" class="form-control" type="text" placeholder="本名" required>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-xs-3 control-label">Last Name:</label>
                    <div class="col-xs-9" style="padding-right: 50px">
                      <input id="lastNameInput" class="form-control" type="text" placeholder="姓" required>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-xs-3 control-label">Age:</label>
                    <div class="col-xs-9" style="padding-right: 50px">
                      <input id="ageInput" class="form-control" type="number" placeholder="年齡">
                    </div>
                  </div>
                  <h4>Type:</h4>
                  <div class="col-xs-6">
                    <div class="form-check">
                      <input type="checkbox" class="form-check-input" id="publisher" value="PUBLISHER">
                      <label class="form-check-label" for="publisher">Publisher</label>
                    </div>
                    <div class="form-check">
                      <input type="checkbox" class="form-check-input" id="ubp" value="UNBAPTIZED_PUBLISHER">
                      <label class="form-check-label" for="ubp">Unbaptized Publisher</label>
                    </div>
                    <div class="form-check">
                      <input type="checkbox" class="form-check-input" id="pioneer" value="REGULAR_PIONEER">
                      <label class="form-check-label" for="pioneer">Regular Pioneer</label>
                    </div>
                  </div>
                  <div class"col-xs-6">
                    <div class="form-check">
                      <input type="checkbox" class="form-check-input" id="specialPioneer" value="SPECIAL_PIONEER">
                      <label class="form-check-label" for="specialPioneer">Special Pioneer</label>
                    </div>
                    <div class="form-check">
                      <input type="checkbox" class="form-check-input" id="elder" value="ELDER">
                      <label class="form-check-label" for="elder">Elder</label>
                    </div>
                    <div class="form-check">
                      <input type="checkbox" class="form-check-input" id="ministerialServant" value="MINISTERIAL_SERVANT">
                      <label class="form-check-label" for="ministerialServant">Ministerial Servant</label>
                    </div>
                  </div>
              </div>
              <div class="modal-footer">
                <div id="button-row" class="pull-left">
                  <button id="addPublisherButton" class="btn btn-success" type="submit">add</button>
                  <script type="text/javascript">
                    $('#addPublisherForm').on('submit', function(e) {
                      e.preventDefault();

                      //construct URL
                      var congId = 1; //change this later
                      var url = "http://localhost:8080/api/congregation/" + congId + "/publisher";

                      //create publisher based on input
                      var pubTypes = $('input:checkbox:checked').map(function() {
                        return this.value;
                      }).get();

                      var publisher = {
                        firstName: $("#firstNameInput").val(),
                        lastName: $("#lastNameInput").val(),
                        age: $("#ageInput").val(),
                        publisherTypes: pubTypes
                      };

                      //AJAX call
                      $.ajax({
                        url: url,
                        type: 'POST',
                        dataType: 'json',
                        contentType: "application/json; charset=utf-8",
                        data: JSON.stringify(publisher),
                      }).done(function(data) {
                        console.log("Successfully created publisher");
                      });

                      //close modal
                      $('#addPublisherModal').modal('toggle');

                    })
                  </script>
                </div>
                <div id="button-row" class="pull-right">
                  <button id="clearAll" class="btn btn-default btn-danger" type="submit">clear all</button>
                </div>
              </div>
              </form>
            </div>
          </div>
        </div>
        <div id='publisherList' class="col-xs-9">
          <!-- List of all publishers here -->
        </div>
      </div>
      <script type="text/javascript">
        function getPublishers(congId) { //should be named getCongregationPublishers
          congId = 1; // TODO change this later
          var url = "http://localhost:8080/api/congregation/" + congId + "/publishers";

          $.ajax({
            url: url,
            type: 'GET',
            dataType: 'json',
            async: false
          }).done(function(data) {
            //console.log(data);

            for (i = 0; i < data.length; i++) {
              var name = data[i].firstName.trim() + " " + data[i].lastName.trim();
              var age = data[i].age;
              //var baptismDate = data[i].baptismDate;
              var type = data[i].publisherTypes;
              var notes = data[i].notes;
              if (notes == null) {
                notes = '';
              };

              var types = "<ul>";
              var j;
              type = JSON.stringify(type);
              type = type.split(",");
              for (j = 0; j < type.length; j++) {
                types += "<li>" + type[j].replace(/[\W_]+/g," ").toLowerCase() + "</li>";
              }
              types += "</ul>";
              var publisherCollapse =
                `<div class="panel-group">
                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h4 class="panel-title">
                          <a data-toggle="collapse" href="#collapse` + i + `">`
                          + `<div class='form-inline'>
                              <span id='publisherHeaderName' class='nowrap'>` + name + `</span>
                              <span class='pull-right nowrap'>#` + (i + 1) + `</span>
                             </div>
                          </a>
                        </h4>
                      </div>
                    <div id="collapse` + i + `" class="panel-collapse collapse">
                    <div class="panel-body">
                    <p id='publisherHeaderContent'>Age: ` + age +
                    `<br>Type: ` + types +
                    `</p>Notes: ` + notes +
                `</div>
                    <div class="panel-footer">
                      <button id="editPublisherButton" class="btn btn-info">edit publisher</button>
                    </div>
                  </div>
                </div>
                </div>`;

              $('#publisherList').append(publisherCollapse);
            }
          })
        };

        getPublishers(1);
      </script>
</body>

</html>
